import tkinter
import sqlite3
import tkinter.messagebox

#creating a window
window = tkinter.Tk() #this opens up the window
window.title("Sign-up or Log-in") #this gives the window a name called signup or login

def signUpForm():
    signUpbutton.pack_forget()
    logInbutton.pack_forget()
    frame= tkinter.Frame(window) #creates a frame inside the window
    frame.pack()

    def submit():
        firstNameValue = firstNameEntry.get() #getting the value entered in the first name entry
        if len(firstNameValue)<1 or len(firstNameValue)>20: 
            tkinter.messagebox.showerror(title= "Invalid First Name", message="First name must be between 1 and 20 characters.") #popup error message
            return 

        lastNameValue = lastNameEntry.get() #getting the value entered in the last name entry
        if len(lastNameValue)<1 or len(lastNameValue)>40:
            tkinter.messagebox.showerror(title= "Invalid Last Name", message="Last name must be between 1 and 40 characters.") #popup error message
            return
        
        usernameValue = usernameEntry.get() #getting the value entered in the username entry
        if len(usernameValue)<1 or len(usernameValue)>20:
            tkinter.messagebox.showerror(title= "Invalid Username", message="Username must be between 1 and 20 characters.") #popup error message
            return
        usernameExists = False
        conn = sqlite3.connect('user_data.db') 
        cursor = conn.cursor()
        cursor.execute("SELECT username FROM users WHERE username=?", (usernameValue,)) #checking if the username already exists in the database and if it does then a popup error message will appear
        if cursor.fetchone() is not None:
            usernameExists = True
            tkinter.messagebox.showerror(title= "Invalid Username", message="Username already exists.")
            return
        conn.close()

        passwordValue = passwordEntry.get() #getting the value entered in the password entry
        if len(passwordValue) <8:
            tkinter.messagebox.showerror(title= "Invalid Password", message="Password must be 8 characters or more.") #popup error message
            return
        hasSpecialChar = False 
        for i in range (0, len(passwordValue)): #loop to check that there is a special character in the password
            if passwordValue[i] in "!@#$%^&*-_=+;:,<>?":
                hasSpecialChar = True
        if not hasSpecialChar:
            tkinter.messagebox.showerror(title= "Invalid Password", message="Password must contain at least one special character")
            return
        hasNumber = False
        for i in range (0, len(passwordValue)): #loop to check that there is a number in the password
            if passwordValue[i] == "0" or passwordValue[i] == "1" or passwordValue[i] == "2" or passwordValue[i] == "3" or passwordValue[i] == "4" or passwordValue[i] == "5" or passwordValue[i] == "6" or passwordValue[i] == "7" or passwordValue[i] == "8" or passwordValue[i] == "9":
                hasNumber = True
        if not hasNumber:
            tkinter.messagebox.showerror(title= "Invalid Password", message="Password must contain at least one number")#popup error message
            return
        
        emailValue = emailEntry.get() #getting the value entered in the email entry
        if "@" not in emailValue or "." not in emailValue: #checking that the email contains @ and .
            tkinter.messagebox.showerror(title= "Invalid Email", message="Email must contain @ and . ")
            return
        print("First Name:", firstNameValue)
        print("Last Name:", lastNameValue)
        print("Username:", usernameValue)
        print("Password:", passwordValue)
        print("Email:", emailValue)

        #creating or connecting to a database
        conn = sqlite3.connect('user_data.db')
        userTable_query = '''CREATE TABLE IF NOT EXISTS users (userID INTEGER PRIMARY KEY,first_name TEXT, last_name TEXT, username TEXT, password TEXT, email TEXT) 
        '''
        conn.execute(userTable_query)
        #inserting data into the database
        userTable_query = '''INSERT INTO users (userID,first_name, last_name, username, password, email) VALUES (?, ?, ?, ?, ?, ?)'''
        userTable_tuple = (None, firstNameValue, lastNameValue, usernameValue, passwordValue, emailValue)
        cursor = conn.cursor()
        cursor.execute(userTable_query, userTable_tuple)
        conn.commit()
        conn.close()

        window.destroy() #closes the window after submission


    signUpFrame = tkinter.LabelFrame(frame, text="Personal information") #creates a labelled frame inside the frame
    signUpFrame.grid(row= 0, column=0, padx=20, pady=20) #places the labelled frame at row 0 column 0 of the frame
    signUpFrame2 = tkinter.LabelFrame(frame, text="Account details") #creates a labelled frame inside the frame
    signUpFrame2.grid(row=1, column=0,sticky = "news", padx=20, pady=20) #places the labelled frame at row 1 column 0 of the frame
    signUpFrame3 = tkinter.LabelFrame(frame, text="Email") #creates a labelled frame inside the frame
    signUpFrame3.grid(row=2, column=0,sticky = "news", padx=20, pady=20) #places the labelled frame at row 2 column 0 of the frame

    firstName = tkinter.Label(signUpFrame, text="First name:") #creating the firstname entry
    firstName.config(font = ("ariel",15))
    firstName.grid(row=0, column=0)
    firstNameEntry = tkinter.Entry(signUpFrame)
    firstNameEntry.grid(row=1, column=0)

    lastName = tkinter.Label(signUpFrame, text="Last name:") #creating the lastname entry
    lastName.config(font = ("ariel",15))
    lastName.grid(row=0, column=1)
    lastNameEntry = tkinter.Entry(signUpFrame)
    lastNameEntry.grid(row=1, column=1)

    username = tkinter.Label(signUpFrame2, text="Username:") #creating the username entry
    username.config(font = ("ariel",15))
    username.grid(row=0, column=0)
    usernameEntry = tkinter.Entry(signUpFrame2)
    usernameEntry.grid(row=1, column=0)

    password = tkinter.Label(signUpFrame2, text="Password:") #creating the password entry
    password.config(font = ("ariel",15))
    password.grid(row=0, column=1)
    passwordEntry = tkinter.Entry(signUpFrame2, show="*")
    passwordEntry.grid(row=1, column=1)

    email = tkinter.Label(signUpFrame3, text="Email:") #creating the email entry
    signUpFrame.grid_columnconfigure(0, weight=1)
    email.config(font = ("ariel",15))
    email.grid(row=0, column=0, columnspan=1, sticky="nsew")
    emailEntry = tkinter.Entry(signUpFrame3)
    emailEntry.grid(row=1, column=0, columnspan=1,sticky="nsew")

    submitButton = tkinter.Button(frame, text="Submit", command= submit) #creating the submit button
    submitButton.config(font = ("ariel",15))
    submitButton.grid(row=3 , column=0, sticky="news", padx=20, pady=20)


def logInForm():

    signUpbutton.pack_forget()
    logInbutton.pack_forget()

    def submit():
        global usernameValue
        global passwordValue
        usernameValue = usernameEntry.get() #getting the value entered in the username entry
        passwordValue = passwordEntry.get() #getting the value entered in the password entry
        print("Username:", usernameValue)
        print("Password:", passwordValue)
        verifyLogIn()
        window.destroy() #closes the window after submission

    frame= tkinter.Frame(window) #creates a frame inside the window
    frame.pack()

    logInFrame = tkinter.LabelFrame(frame, text="Log-in details") #creates a labelled frame inside the frame
    logInFrame.grid(row= 0, column=0, padx=20, pady=20) #places the labelled frame at row 0 column 0 of the frame
    
    username = tkinter.Label(logInFrame, text="Username:") #creating the username entry
    username.config(font = ("ariel",15))
    username.grid(row=0, column=0)
    usernameEntry = tkinter.Entry(logInFrame)
    usernameEntry.grid(row=0, column=1)

    password = tkinter.Label(logInFrame, text="Password:") #creating the password entry
    password.config(font = ("ariel",15))    
    password.grid(row=1, column=0)
    passwordEntry = tkinter.Entry(logInFrame, show="*")
    passwordEntry.grid(row=1, column=1)

    submitButton = tkinter.Button(frame, text="Submit", command=submit) #creating the submit button
    submitButton.config(font = ("ariel",15))
    submitButton.grid(row=2, column=0, sticky="news", padx=20, pady=20)



def verifyLogIn():
    conn = sqlite3.connect('user_data.db') 
    cursor = conn.cursor()
    cursor.execute("SELECT username FROM users WHERE username=?", (usernameValue,)) #checking if the username exists in the database
    if cursor.fetchone() is None:
        signUpForm()
    conn.close()

    

#creating the sign up and log in buttons
signUpbutton = tkinter.Button(window, text = "Sign-up", command= signUpForm) #creates a button called sign in
signUpbutton.config(font = ("ariel",50)) #the sign in button will have the ariel font and size 50
signUpbutton.config(bg = "lightblue") #the background colour of the sign in button will be light blue
signUpbutton.config(fg = "black") #the text colour of the sign in button will be black
signUpbutton.pack(side="left", expand=True )
   
logInbutton = tkinter.Button(window, text = "Log-in", command = logInForm) #creates a button called log in
logInbutton.config(font = ("ariel",50)) #the log in button will have the ariel font and size 50
logInbutton.config(bg = "lightgreen") #the background colour of the log in button will be light green
logInbutton.config(fg = "black") #the text colour of the log in button will be black
logInbutton.pack(side="right", expand=True)   



window.mainloop() #the application window will continue running until x is pressed and the main loop will stop being exectuted#






